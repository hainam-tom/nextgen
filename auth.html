<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vendly — Sign in / Create account</title>
  <meta name="description" content="Sign in or create your Vendly account. Session-aware login with remembered accounts. No backend wired yet." />

  <!-- CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.css" rel="stylesheet"/>

  <style>
    :root { --radius: 16px; --easing: cubic-bezier(.2,.8,.2,1); }
    html, body { height: 100% }
    body { -webkit-font-smoothing: antialiased; }
    .glass { background: color-mix(in oklab, var(--bs-body-bg) 88%, transparent); backdrop-filter: blur(10px) saturate(1.1); border-bottom: 1px solid var(--bs-border-color) }
    .appmark { width:34px;height:34px }

    /* Router: one view visible at a time with transitions */
    .view { display:none; animation: fadeSlide .28s var(--easing) both }
    .view.active { display:block }
    @keyframes fadeSlide { from { opacity:0; transform: translateY(8px) } to { opacity:1; transform: translateY(0) } }

    /* Auth card */
    .auth-card { border-radius: var(--radius); border:1px solid var(--bs-border-color); box-shadow: 0 16px 40px rgba(0,0,0,.18) }

    /* Password strength meter */
    .strength { height:8px; border-radius: 6px; background: #343a40; overflow: hidden }
    .strength > div { height: 100%; width: 0%; transition: width .25s var(--easing); }

    .avatar-ph { width:56px; height:56px; border-radius: 999px; display:inline-flex; align-items:center; justify-content:center; border:1px solid var(--bs-border-color); background: rgba(255,255,255,.06) }
    html[data-bs-theme="light"] .avatar-ph { background: #eef2f7 }

    /* Account chips */
    .acct-chip { border:1px solid var(--bs-border-color); border-radius: 999px; padding: 6px 10px; display:inline-flex; align-items:center; gap:.5rem; cursor:pointer; transition: transform .12s var(--easing) }
    .acct-chip:hover { transform: translateY(-1px) }
    .acct-chip img { width:24px;height:24px;border-radius:999px;object-fit:cover }
    .acct-chip .bi-person { font-size: 1rem }
  </style>
</head>
<body>
  <header class="glass sticky-top">
    <nav class="navbar container">
      <a class="navbar-brand fw-bold d-flex align-items-center gap-2" href="#/login" title="Vendly">
        <span class="appmark d-inline-flex align-items-center justify-content-center rounded-3 text-bg-primary"><i class="bi bi-bag"></i></span>
        <span>Vendly</span>
      </a>
      <div class="ms-auto d-flex align-items-center gap-2">
        <button class="btn btn-outline-secondary" id="themeBtn" title="Toggle theme"><i class="bi bi-moon-stars"></i></button>
      </div>
    </nav>
  </header>

  <main class="container my-5 my-md-6" style="max-width: 920px">

    <!-- LOGIN -->
    <section id="view-login" class="view">
      <div class="row g-4 align-items-stretch">
        <div class="col-lg-6">
          <div class="auth-card p-4 p-md-5 h-100">
            <div class="d-flex align-items-center gap-3 mb-3">
              <span class="avatar-ph overflow-hidden" id="loginAvatar"><i class="bi bi-person fs-4"></i></span>
              <div>
                <h1 class="h4 mb-0"><span id="loginTitle">Welcome back</span></h1>
                <div class="text-secondary small" id="loginSubtitle">Sign in to continue</div>
              </div>
            </div>

            <!-- Identity strip (shown when a saved session exists) -->
            <div id="loginIdentity" class="d-none mb-2">
              <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                <div class="small">
                  <span class="text-secondary me-1">Signed in as</span>
                  <span class="badge text-bg-secondary" id="loginEmailBadge"></span>
                </div>
                <div class="d-flex gap-2">
                  <button class="btn btn-outline-secondary btn-sm" id="useDifferentBtn">Use another account</button>
                  <button class="btn btn-outline-danger btn-sm" id="forgetDeviceBtn">Forget this device</button>
                </div>
              </div>
              <div id="savedAccountsRow" class="mt-2 d-none">
                <div class="small text-secondary mb-1">Switch account</div>
                <div id="accountChips" class="d-flex flex-wrap gap-2"></div>
              </div>
            </div>

            <form id="loginForm" class="d-grid gap-3" novalidate>
              <div id="loginEmailWrap">
                <label class="form-label" for="loginEmail">Email</label>
                <input type="email" class="form-control" id="loginEmail" name="loginEmail" autocomplete="username" inputmode="email" spellcheck="false" required maxlength="254">
              </div>
              <div>
                <label class="form-label" for="loginPassword">Password</label>
                <div class="input-group">
                  <input type="password" class="form-control" id="loginPassword" name="loginPassword" autocomplete="current-password" minlength="8" required>
                  <button class="btn btn-outline-secondary" type="button" data-toggle-pass="#loginPassword" title="Show/Hide"><i class="bi bi-eye"></i></button>
                </div>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="rememberMe">
                  <label class="form-check-label" for="rememberMe">Remember me</label>
                </div>
                <a href="#/forgot" class="link-secondary">Forgot password?</a>
              </div>
              <button class="btn btn-primary btn-lg" type="submit">Sign in</button>
            </form>

            <hr class="my-4">
            <div class="text-center small">New to Vendly? <a href="#/register">Create an account</a></div>
          </div>
        </div>
        <aside class="col-lg-6">
          <div class="auth-card p-4 p-md-5 h-100 d-grid align-content-between" style="min-height: 100%">
            <div>
              <h2 class="h5">Why join?</h2>
              <ul class="text-secondary small mb-0 ps-3">
                <li>Fast checkout and saved addresses</li>
                <li>Order history and status tracking</li>
                <li>Early access to drops and promos</li>
              </ul>
            </div>
            <div class="text-center">
              <a href="#/register" class="btn btn-outline-primary btn-lg"><i class="bi bi-person-plus me-1"></i>Create your account</a>
            </div>
          </div>
        </aside>
      </div>
    </section>

    <!-- REGISTER -->
    <section id="view-register" class="view">
      <div class="auth-card p-4 p-md-5">
        <h1 class="h4 mb-1">Create your account</h1>
        <div class="text-secondary small mb-3">It only takes a minute.</div>

        <form id="registerForm" class="row g-3" novalidate>
          <div class="col-12">
            <label class="form-label" for="regAvatar">Profile photo (optional)</label>
            <input type="file" accept="image/*" class="form-control" id="regAvatar">
            <div class="form-text">JPG/PNG, up to 2MB.</div>
          </div>
          <div class="col-md-6">
            <label class="form-label" for="regFirstName">First name</label>
            <input class="form-control" id="regFirstName" name="regFirstName" autocomplete="given-name" autocapitalize="words" minlength="2" maxlength="60" pattern="^[A-Za-z ,.'-]{2,60}$" required>
          </div>
          <div class="col-md-6">
            <label class="form-label" for="regLastName">Last name</label>
            <input class="form-control" id="regLastName" name="regLastName" autocomplete="family-name" autocapitalize="words" minlength="2" maxlength="60" pattern="^[A-Za-z ,.'-]{2,60}$" required>
          </div>
          <div class="col-md-6">
            <label class="form-label" for="regEmail">Email</label>
            <input type="email" class="form-control" id="regEmail" name="regEmail" autocomplete="email" inputmode="email" spellcheck="false" maxlength="254" required>
          </div>
          <div class="col-md-6">
            <label class="form-label" for="regPhone">Phone</label>
            <input class="form-control" id="regPhone" name="regPhone" autocomplete="tel" inputmode="tel" maxlength="20">
          </div>
          <div class="col-md-6">
            <label class="form-label" for="regPassword">Password</label>
            <div class="input-group">
              <input type="password" class="form-control" id="regPassword" name="regPassword" autocomplete="new-password" minlength="8" maxlength="128" required>
              <button class="btn btn-outline-secondary" type="button" data-toggle-pass="#regPassword" title="Show/Hide"><i class="bi bi-eye"></i></button>
            </div>
            <div class="strength bg-secondary-subtle mt-2" aria-hidden="true"><div id="pwdStrengthBar" class="bg-danger" style="width:0%"></div></div>
            <div class="form-text" id="pwdStrengthText">Use at least 8 characters. Add numbers and symbols for a stronger password.</div>
          </div>
          <div class="col-md-6">
            <label class="form-label" for="regConfirm">Confirm password</label>
            <div class="input-group">
              <input type="password" class="form-control" id="regConfirm" name="regConfirm" autocomplete="new-password" minlength="8" maxlength="128" required>
              <button class="btn btn-outline-secondary" type="button" data-toggle-pass="#regConfirm" title="Show/Hide"><i class="bi bi-eye"></i></button>
            </div>
          </div>
          <div class="col-12">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="regTerms" name="regTerms" required>
              <label class="form-check-label" for="regTerms">I agree to the Terms and Privacy Policy</label>
            </div>
          </div>
          <div class="col-12 d-grid d-md-flex gap-2">
            <button class="btn btn-primary btn-lg" type="submit"><i class="bi bi-person-plus me-1"></i>Create account</button>
            <a href="#/login" class="btn btn-outline-secondary btn-lg">Back to sign in</a>
          </div>
        </form>
      </div>
    </section>

    <!-- FORGOT PASSWORD (UI only) -->
    <section id="view-forgot" class="view">
      <div class="auth-card p-4 p-md-5">
        <h1 class="h4 mb-1">Reset your password</h1>
        <div class="text-secondary small mb-3">Enter the email associated with your account.</div>
        <form id="forgotForm" class="row g-3" novalidate>
          <div class="col-md-8 col-lg-6">
            <label class="form-label" for="fpEmail">Email</label>
            <input type="email" class="form-control" id="fpEmail" name="fpEmail" autocomplete="email" inputmode="email" spellcheck="false" maxlength="254" required>
          </div>
          <div class="col-12 d-grid d-md-flex gap-2">
            <button class="btn btn-primary" type="submit">Send reset link</button>
            <a href="#/login" class="btn btn-outline-secondary">Back to sign in</a>
          </div>
        </form>
      </div>
    </section>

  </main>

  <footer class="border-top py-4 mt-4">
    <div class="container d-flex flex-wrap gap-2 justify-content-between align-items-center small text-secondary">
      <div>© <span id="year"></span> Vendly.</div>
      <div class="d-flex gap-3">
        <a href="#/login" class="link-secondary">Sign in</a>
        <a href="#/register" class="link-secondary">Create account</a>
      </div>
    </div>
  </footer>

  <!-- JS deps (order matters: jQuery first for plugins) -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/additional-methods.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/inputmask@5.0.9/dist/inputmask.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.js"></script>

  <script>
  // ========= UTIL =========
  const $qs = (sel, el=document) => el.querySelector(sel);
  const $$qs = (sel, el=document) => [...el.querySelectorAll(sel)];
  const toast = (msg) => Toastify({ text: msg, gravity:'bottom', position:'right', duration:2000, className:'bg-dark text-white' }).showToast();
  function applyTheme(next){ const cur = document.documentElement.getAttribute('data-bs-theme')||'dark'; const t = next || (cur==='light'?'dark':'light'); document.documentElement.setAttribute('data-bs-theme', t); localStorage.setItem('nm_theme', t); }

  // ========= ACCOUNT STORAGE (UI only / localStorage) =========
  const ACCOUNTS_KEY = 'nm_accounts';
  const ACTIVE_EMAIL_KEY = 'nm_auth_email';
  function getAccounts(){ try { return JSON.parse(localStorage.getItem(ACCOUNTS_KEY)||'[]'); } catch(e){ return []; } }
  function saveAccounts(list){ localStorage.setItem(ACCOUNTS_KEY, JSON.stringify(list.slice(0,5))); }
  function setActiveEmail(email){ if(email) localStorage.setItem(ACTIVE_EMAIL_KEY, email); else localStorage.removeItem(ACTIVE_EMAIL_KEY); }
  function getActiveAccount(){ const email = localStorage.getItem(ACTIVE_EMAIL_KEY); if(!email) return null; const acc = getAccounts().find(a => a.email === email); return acc || { email, name: '', avatar:'' } }
  function deriveNameFromEmail(em){ const local = (em||'').split('@')[0].replace(/[._-]+/g,' '); return local.split(' ').map(s=> s? s.charAt(0).toUpperCase()+s.slice(1) : '').join(' ').trim() || 'Account'; }
  function upsertAccount(obj){ const email = (obj.email||'').trim(); if(!email) return; const list = getAccounts(); const i = list.findIndex(a => a.email === email); const entry = { email, name: obj.name||deriveNameFromEmail(email), avatar: obj.avatar||'' }; if(i>=0) list[i] = { ...list[i], ...entry }; else list.unshift(entry); saveAccounts(list); setActiveEmail(email); }

  // ========= ROUTER =========
  const routes = { '/login': renderLogin, '/register': renderRegister, '/forgot': renderForgot };
  function parseHash(){ const h = location.hash.replace(/^#/, '') || '/login'; const [path, qs] = h.split('?'); return { path, params: Object.fromEntries(new URLSearchParams(qs||'')) }; }
  function route(path, params={}){ const qs = new URLSearchParams(params).toString(); location.hash = path + (qs?`?${qs}`:''); }
  function onRoute(){ const { path, params } = parseHash(); $$qs('.view').forEach(v=>v.classList.remove('active')); const map = { '/login':'view-login','/register':'view-register','/forgot':'view-forgot' }; const id = map[path] || 'view-login'; const view = document.getElementById(id); if(view) view.classList.add('active'); (routes[path] || routes['/login'])(params); }
  window.addEventListener('hashchange', onRoute);

  // ========= RENDERERS =========
  function renderLogin(){
    // Determine session state via a clear variable, as requested
    let savedSession = getActiveAccount(); // {email, name, avatar} | null
    const hasSession = !!savedSession;

    // Header visuals
    const avatar = $qs('#loginAvatar');
    const title = $qs('#loginTitle');
    const sub = $qs('#loginSubtitle');
    const idStrip = $qs('#loginIdentity');
    const emailBadge = $qs('#loginEmailBadge');
    const emailWrap = $qs('#loginEmailWrap');
    const diffBtn = $qs('#useDifferentBtn');
    const forgetBtn = $qs('#forgetDeviceBtn');

    if(hasSession){
      const name = savedSession.name || deriveNameFromEmail(savedSession.email);
      title.textContent = `Welcome back, ${name}`;
      sub.textContent = 'Enter your password to continue';
      emailBadge.textContent = savedSession.email;
      idStrip.classList.remove('d-none');
      emailWrap.classList.add('d-none');
      // Avatar
      if(savedSession.avatar){ avatar.innerHTML = `<img alt="avatar" src="${savedSession.avatar}" style="width:100%;height:100%;object-fit:cover">`; }
      else { avatar.innerHTML = '<i class="bi bi-person fs-4"></i>'; }
      // Build account chips if multiple remembered
      const chipsRow = $qs('#savedAccountsRow');
      const chips = $qs('#accountChips');
      const list = getAccounts();
      if(list.length > 1 && chips && chipsRow){
        chipsRow.classList.remove('d-none');
        chips.innerHTML = list.map(a=>`<span class="acct-chip" data-email="${a.email}">${a.avatar?`<img src="${a.avatar}" alt="">`:'<i class="bi bi-person"></i>'}<span class="small">${a.email}</span></span>`).join('');
        $$qs('.acct-chip', chips).forEach(ch=> ch.onclick = ()=>{ setActiveEmail(ch.dataset.email); renderLogin(); });
      } else if(chipsRow) { chipsRow.classList.add('d-none'); }
    } else {
      title.textContent = 'Welcome back';
      sub.textContent = 'Sign in to continue';
      idStrip.classList.add('d-none');
      emailWrap.classList.remove('d-none');
      avatar.innerHTML = '<i class="bi bi-person fs-4"></i>';
    }

    // Toggle to use another account (shows email input without destroying saved list)
    if(diffBtn){ diffBtn.onclick = ()=>{ emailWrap.classList.toggle('d-none'); if(!emailWrap.classList.contains('d-none')){ $qs('#loginEmail').focus(); } }; }

    // Forget this device (clears active email, keeps accounts list intact)
    if(forgetBtn){ forgetBtn.onclick = ()=>{ setActiveEmail(null); toast('Device forgotten'); renderLogin(); }; }

    // jQuery Validate if present
    if (window.jQuery && $.fn && $.fn.validate) {
      $('#loginForm').validate({
        rules: { loginEmail: { required: !hasSession, email:true }, loginPassword: { required:true, minlength:8 } },
        messages: { loginEmail: 'Please enter your email' },
        errorClass: 'is-invalid', validClass: 'is-valid'
      });
    }

    // Submit handler
    const form = $qs('#loginForm');
    if(form){
      form.onsubmit = (e)=>{
        e.preventDefault();
        if (window.jQuery && $.fn && $.fn.validate) { if(!$('#loginForm').valid()){ toast('Please fix the highlighted fields'); return; } }
        else { if(!form.checkValidity()){ form.classList.add('was-validated'); toast('Please fix the highlighted fields'); return; } }

        const emailInput = $qs('#loginEmail');
        const email = hasSession ? savedSession.email : (emailInput?.value || '').trim();
        const remember = $qs('#rememberMe')?.checked;
        if(remember && email){ upsertAccount({email}); }
        toast(`Signed in as ${email}`);
      };
    }
  }

  function renderRegister(){
    // Masks
    if(window.Inputmask){ Inputmask({ mask: '+9{6,15}' }).mask('#regPhone'); }

    // Optional avatar pick -> DataURL
    let regAvatarDataUrl = '';
    const av = $qs('#regAvatar');
    if(av){ av.onchange = ()=>{ const f = av.files?.[0]; if(!f) return; if(!f.type || !f.type.startsWith('image/')) return toast('Please choose an image'); if(f.size>2*1024*1024) return toast('Image must be under 2MB'); const reader = new FileReader(); reader.onload = ()=> regAvatarDataUrl = String(reader.result||''); reader.readAsDataURL(f); }; }

    // Password strength
    const pwd = $qs('#regPassword'); const bar = $qs('#pwdStrengthBar'); const txt = $qs('#pwdStrengthText');
    if(pwd && bar){
      pwd.addEventListener('input', ()=>{
        const score = (window.zxcvbn? zxcvbn(pwd.value).score : 0);
        const pct = [5,25,50,75,100][score];
        bar.style.width = pct + '%';
        bar.className = score<2? 'bg-danger' : score<3? 'bg-warning' : 'bg-success';
        if(txt) txt.textContent = ['Very weak','Weak','Fair','Good','Strong'][score];
      });
    }

    // Validate
    if (window.jQuery && $.fn && $.fn.validate) {
      $('#registerForm').validate({
        rules:{
          regFirstName:{required:true,minlength:2},
          regLastName:{required:true,minlength:2},
          regEmail:{required:true,email:true},
          regPhone:{required:false},
          regPassword:{required:true,minlength:8},
          regConfirm:{required:true,equalTo:'#regPassword'},
          regTerms:{required:true}
        },
        messages:{ regTerms:'Please accept the terms to continue.' },
        errorClass:'is-invalid', validClass:'is-valid'
      });
    }

    const form = $qs('#registerForm');
    if(form){ form.onsubmit = (e)=>{
      e.preventDefault();
      if (window.jQuery && $.fn && $.fn.validate) { if(!$('#registerForm').valid()){ toast('Please fix the highlighted fields'); return; } }
      else {
        if(!form.checkValidity()){ form.classList.add('was-validated'); toast('Please fix the highlighted fields'); return; }
        if($qs('#regPassword')?.value !== $qs('#regConfirm')?.value){ toast('Passwords do not match'); return; }
      }
      const first = $qs('#regFirstName')?.value?.trim()||''; const last = $qs('#regLastName')?.value?.trim()||''; const email = $qs('#regEmail')?.value?.trim()||'';
      const name = `${first} ${last}`.trim();
      upsertAccount({ email, name, avatar: regAvatarDataUrl });
      toast('Account created');
      route('/login');
    }; }
  }

  function renderForgot(){
    if (window.jQuery && $.fn && $.fn.validate) {
      $('#forgotForm').validate({ rules:{ fpEmail:{required:true,email:true} }, errorClass:'is-invalid', validClass:'is-valid' });
    }
    const form = $qs('#forgotForm'); if(form){ form.onsubmit = (e)=>{ e.preventDefault(); if (window.jQuery && $.fn && $.fn.validate) { if(!$('#forgotForm').valid()){ toast('Enter a valid email'); return; } } else { if(!form.checkValidity()){ form.classList.add('was-validated'); toast('Enter a valid email'); return; } } toast('Reset link sent'); route('/login'); }; }
  }

  // ========= Common widgets =========
  function wirePasswordToggles(){
    $$qs('[data-toggle-pass]').forEach(btn=>{
      btn.onclick = ()=>{
        const sel = btn.getAttribute('data-toggle-pass'); const input = sel && document.querySelector(sel);
        if(!input) return;
        const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
        input.setAttribute('type', type);
        btn.innerHTML = type==='password' ? '<i class="bi bi-eye"></i>' : '<i class="bi bi-eye-slash"></i>';
      };
    });
  }

  // ========= Boot =========
  function boot(){
    const themeBtn = document.getElementById('themeBtn'); if(themeBtn) themeBtn.onclick = ()=> applyTheme();
    const yearEl = document.getElementById('year'); if(yearEl) yearEl.textContent = new Date().getFullYear();
    onRoute(); if(!location.hash) route('/login');
    wirePasswordToggles();
  }
  window.addEventListener('DOMContentLoaded', boot);

  // Global error notice for failed external scripts
  window.addEventListener('error', (e)=>{
    if(String(e.message).toLowerCase().includes('script error')){
      toast('Some external libraries failed to load. The page will still work with basic validation.');
    }
  });
  </script>
</body>
</html>

